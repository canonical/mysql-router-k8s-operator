{"uid":"9099b6017e1ac8d5","name":"test_upgrade_from_edge","fullName":"tests.integration.test_upgrade#test_upgrade_from_edge","historyId":"59e96b2cf75bb30d0a5cbde0e5234d56","time":{"start":1722822739445,"stop":1722823061607,"duration":322162},"description":"Upgrade mysqlrouter while ensuring continuous writes incrementing.","descriptionHtml":"<p>Upgrade mysqlrouter while ensuring continuous writes incrementing.</p>\n","status":"failed","statusMessage":"AssertionError: None of the units are upgraded\nassert '+testupgrade' in 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:57:41Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.109  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.81   no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.237  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.178.77         Primary\\nmysql-router-k8s/0   active       idle   10.1.178.74         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.178.75         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.178.78         \\nmysql-test-app/0*    active       idle   10.1.178.72         \\n'\n +  where 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:57:41Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.109  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.81   no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.237  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.178.77         Primary\\nmysql-router-k8s/0   active       idle   10.1.178.74         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.178.75         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.178.78         \\nmysql-test-app/0*    active       idle   10.1.178.72         \\n' = get_juju_status('test')\n +    where 'test' = <juju.model.Model object at 0x7f53754cd030>.name\n +      where <juju.model.Model object at 0x7f53754cd030> = <pytest_operator.plugin.OpsTest object at 0x7f53752b3670>.model","statusTrace":"Traceback (most recent call last):\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 241, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    yield from thread_exception_runtest_hook()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    yield\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    yield from unraisable_exception_runtest_hook()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    yield\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/logging.py\", line 850, in pytest_runtest_call\n    yield from self._runtest_for(item, \"call\")\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/logging.py\", line 833, in _runtest_for\n    yield\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/capture.py\", line 878, in pytest_runtest_call\n    return (yield)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    return (yield)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 183, in pytest_runtest_call\n    raise e\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1632, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 162, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 529, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/tests/integration/test_upgrade.py\", line 125, in test_upgrade_from_edge\n    for attempt in tenacity.Retrying(\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 443, in __iter__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 376, in iter\n    result = action(retry_state)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 418, in exc_check\n    raise retry_exc.reraise()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 185, in reraise\n    raise self.last_attempt.result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 451, in result\n    return self.__get_result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 403, in __get_result\n    raise self._exception\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/tests/integration/test_upgrade.py\", line 131, in test_upgrade_from_edge\n    assert \"+testupgrade\" in get_juju_status(\nAssertionError: None of the units are upgraded\nassert '+testupgrade' in 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:57:41Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.109  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.81   no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.237  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.178.77         Primary\\nmysql-router-k8s/0   active       idle   10.1.178.74         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.178.75         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.178.78         \\nmysql-test-app/0*    active       idle   10.1.178.72         \\n'\n +  where 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:57:41Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.109  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.81   no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.237  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.178.77         Primary\\nmysql-router-k8s/0   active       idle   10.1.178.74         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.178.75         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.178.78         \\nmysql-test-app/0*    active       idle   10.1.178.72         \\n' = get_juju_status('test')\n +    where 'test' = <juju.model.Model object at 0x7f53754cd030>.name\n +      where <juju.model.Model object at 0x7f53754cd030> = <pytest_operator.plugin.OpsTest object at 0x7f53752b3670>.model","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"event_loop","time":{"start":1722822613768,"stop":1722822613769,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1722822613769,"stop":1722822613769,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1722822613769,"stop":1722822613990,"duration":221},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1722822739445,"stop":1722822739445,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Upgrade mysqlrouter while ensuring continuous writes incrementing.","status":"failed","statusMessage":"AssertionError: None of the units are upgraded\nassert '+testupgrade' in 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:57:41Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.109  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.81   no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.237  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.178.77         Primary\\nmysql-router-k8s/0   active       idle   10.1.178.74         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.178.75         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.178.78         \\nmysql-test-app/0*    active       idle   10.1.178.72         \\n'\n +  where 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:57:41Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.109  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.81   no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.237  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.178.77         Primary\\nmysql-router-k8s/0   active       idle   10.1.178.74         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.178.75         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.178.78         \\nmysql-test-app/0*    active       idle   10.1.178.72         \\n' = get_juju_status('test')\n +    where 'test' = <juju.model.Model object at 0x7f53754cd030>.name\n +      where <juju.model.Model object at 0x7f53754cd030> = <pytest_operator.plugin.OpsTest object at 0x7f53752b3670>.model","statusTrace":"Traceback (most recent call last):\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 241, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    yield from thread_exception_runtest_hook()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    yield\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    yield from unraisable_exception_runtest_hook()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    yield\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/logging.py\", line 850, in pytest_runtest_call\n    yield from self._runtest_for(item, \"call\")\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/logging.py\", line 833, in _runtest_for\n    yield\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/capture.py\", line 878, in pytest_runtest_call\n    return (yield)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    return (yield)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 183, in pytest_runtest_call\n    raise e\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1632, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 162, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 529, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/tests/integration/test_upgrade.py\", line 125, in test_upgrade_from_edge\n    for attempt in tenacity.Retrying(\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 443, in __iter__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 376, in iter\n    result = action(retry_state)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 418, in exc_check\n    raise retry_exc.reraise()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 185, in reraise\n    raise self.last_attempt.result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 451, in result\n    return self.__get_result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 403, in __get_result\n    raise self._exception\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/tests/integration/test_upgrade.py\", line 131, in test_upgrade_from_edge\n    assert \"+testupgrade\" in get_juju_status(\nAssertionError: None of the units are upgraded\nassert '+testupgrade' in 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:57:41Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.109  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.81   no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.237  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.178.77         Primary\\nmysql-router-k8s/0   active       idle   10.1.178.74         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.178.75         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.178.78         \\nmysql-test-app/0*    active       idle   10.1.178.72         \\n'\n +  where 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:57:41Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.109  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.81   no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.237  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.178.77         Primary\\nmysql-router-k8s/0   active       idle   10.1.178.74         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.178.75         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.178.78         \\nmysql-test-app/0*    active       idle   10.1.178.72         \\n' = get_juju_status('test')\n +    where 'test' = <juju.model.Model object at 0x7f53754cd030>.name\n +      where <juju.model.Model object at 0x7f53754cd030> = <pytest_operator.plugin.OpsTest object at 0x7f53752b3670>.model","steps":[],"attachments":[{"uid":"7c393c94596e0f61","name":"log","source":"7c393c94596e0f61.txt","type":"text/plain","size":594}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"abort_on_fail::0","time":{"start":1722823061612,"stop":1722823061612,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1722823061617,"stop":1722823062025,"duration":408},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1722823062026,"stop":1722823062026,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1722823062026,"stop":1722823062026,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1722823062026,"stop":1722823062027,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"abort_on_fail"},{"name":"tag","value":"group(1)"},{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"tests.integration"},{"name":"suite","value":"test_upgrade"},{"name":"host","value":"fv-az1456-931"},{"name":"thread","value":"12310-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.test_upgrade"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"e1dbf9cf07fd7d3c","status":"unknown","time":{}}],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":4,"broken":0,"skipped":6,"passed":56,"unknown":1,"total":67},"items":[{"uid":"f2aba4fc88b097ed","reportUrl":"../1594//#testresult/f2aba4fc88b097ed","status":"failed","statusDetails":"AssertionError: None of the units are upgraded\nassert '+testupgrade' in 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:58:14Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.65   no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.227  no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.208  no       Last written value=21472\\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.148.13         Primary\\nmysql-router-k8s/0*  active       idle   10.1.148.9          Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1   active       idle   10.1.148.11         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.148.14         \\nmysql-test-app/0*    active       idle   10.1.148.8          Last written value=21472\\n'\n +  where 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:58:14Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.65   no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.227  no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.208  no       Last written value=21472\\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.148.13         Primary\\nmysql-router-k8s/0*  active       idle   10.1.148.9          Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1   active       idle   10.1.148.11         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.148.14         \\nmysql-test-app/0*    active       idle   10.1.148.8          Last written value=21472\\n' = get_juju_status('test')\n +    where 'test' = <juju.model.Model object at 0x7f3e70b6c1f0>.name\n +      where <juju.model.Model object at 0x7f3e70b6c1f0> = <pytest_operator.plugin.OpsTest object at 0x7f3e71fb3ca0>.model","time":{"start":1722736371750,"stop":1722736694813,"duration":323063}},{"uid":"5656a7cbbef20793","reportUrl":"../1593//#testresult/5656a7cbbef20793","status":"failed","statusDetails":"AssertionError: None of the units are upgraded\nassert '+testupgrade' in 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:53:42Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.96   no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.118  no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.244  no       Last written value=28748\\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.118.10         Primary\\nmysql-router-k8s/0   active       idle   10.1.118.11         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.118.12         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.118.14         \\nmysql-test-app/0*    active       idle   10.1.118.8          Last written value=28748\\n'\n +  where 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:53:42Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.96   no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.118  no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.244  no       Last written value=28748\\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.118.10         Primary\\nmysql-router-k8s/0   active       idle   10.1.118.11         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1*  active       idle   10.1.118.12         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.118.14         \\nmysql-test-app/0*    active       idle   10.1.118.8          Last written value=28748\\n' = get_juju_status('test')\n +    where 'test' = <juju.model.Model object at 0x7f556fbec640>.name\n +      where <juju.model.Model object at 0x7f556fbec640> = <pytest_operator.plugin.OpsTest object at 0x7f556fb21690>.model","time":{"start":1722649699854,"stop":1722650022062,"duration":322208}},{"uid":"7d9224b9dabccecf","reportUrl":"../1591//#testresult/7d9224b9dabccecf","status":"failed","statusDetails":"AssertionError: None of the units are upgraded\nassert '+testupgrade' in 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:54:03Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.129  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.211  no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.107  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.187.9          Primary\\nmysql-router-k8s/0*  active       idle   10.1.187.10         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1   active       idle   10.1.187.12         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.187.14         \\nmysql-test-app/0*    active       idle   10.1.187.13         \\n'\n +  where 'Model  Controller          Cloud/Region        Version  SLA          Timestamp\\ntest   microk8s-localhost  microk8s/localhost  3.4.3    unsupported  01:54:03Z\\n\\nApp               Version                  Status   Scale  Charm             Channel      Rev  Address         Exposed  Message\\nmysql-k8s         8.0.37-0ubuntu0.22.04.3  active       1  mysql-k8s         8.0/edge     169  10.152.183.129  no       \\nmysql-router-k8s  8.0.37-0ubuntu0.22.04.3  waiting      3  mysql-router-k8s                 0  10.152.183.211  no       installing agent\\nmysql-test-app    0.0.2                    active       1  mysql-test-app    latest/edge   46  10.152.183.107  no       \\n\\nUnit                 Workload     Agent  Address      Ports  Message\\nmysql-k8s/0*         active       idle   10.1.187.9          Primary\\nmysql-router-k8s/0*  active       idle   10.1.187.10         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/1   active       idle   10.1.187.12         Router 8.0.37 running (restart pending); Charmed operator 1.2+266066c\\nmysql-router-k8s/2   maintenance  idle   10.1.187.14         \\nmysql-test-app/0*    active       idle   10.1.187.13         \\n' = get_juju_status('test')\n +    where 'test' = <juju.model.Model object at 0x7f3a3c31ca30>.name\n +      where <juju.model.Model object at 0x7f3a3c31ca30> = <pytest_operator.plugin.OpsTest object at 0x7f3a3c172b30>.model","time":{"start":1722563321254,"stop":1722563643268,"duration":322014}},{"uid":"10e4b3637d1c2a45","reportUrl":"../1589//#testresult/10e4b3637d1c2a45","status":"passed","time":{"start":1722476270654,"stop":1722476459106,"duration":188452}},{"uid":"6844e5dba68f851f","reportUrl":"../1587//#testresult/6844e5dba68f851f","status":"skipped","statusDetails":"XFAIL reason: aborted\n\n_pytest.outcomes.XFailed: aborted","time":{"start":1722389630186,"stop":1722389630186,"duration":0}},{"uid":"b319ea98354815ba","reportUrl":"../1586//#testresult/b319ea98354815ba","status":"passed","time":{"start":1722303453359,"stop":1722303665858,"duration":212499}},{"uid":"c3dcaf865e08a5e9","reportUrl":"../1578//#testresult/c3dcaf865e08a5e9","status":"passed","time":{"start":1722217045713,"stop":1722217235148,"duration":189435}},{"uid":"474ec7495ffc8186","reportUrl":"../1577//#testresult/474ec7495ffc8186","status":"passed","time":{"start":1722130659877,"stop":1722130844698,"duration":184821}},{"uid":"cc2db278472b42f7","reportUrl":"../1576//#testresult/cc2db278472b42f7","status":"passed","time":{"start":1722044297428,"stop":1722044487001,"duration":189573}},{"uid":"b4edea46f228166b","reportUrl":"../1572//#testresult/b4edea46f228166b","status":"passed","time":{"start":1721957837830,"stop":1721958042163,"duration":204333}},{"uid":"27d9d4fbeeca8e8f","reportUrl":"../1562//#testresult/27d9d4fbeeca8e8f","status":"passed","time":{"start":1721871437415,"stop":1721871628548,"duration":191133}},{"uid":"ea993072c443a69f","reportUrl":"../1558//#testresult/ea993072c443a69f","status":"passed","time":{"start":1721785072989,"stop":1721785263155,"duration":190166}},{"uid":"6cc2c8fe35080a9f","reportUrl":"../1557//#testresult/6cc2c8fe35080a9f","status":"passed","time":{"start":1721698757412,"stop":1721698944544,"duration":187132}},{"uid":"879f55a4b8ae80f9","reportUrl":"../1550//#testresult/879f55a4b8ae80f9","status":"passed","time":{"start":1721612260350,"stop":1721612448956,"duration":188606}},{"uid":"9a9ae0b57e2317cf","reportUrl":"../1549//#testresult/9a9ae0b57e2317cf","status":"passed","time":{"start":1721525871443,"stop":1721526054397,"duration":182954}},{"uid":"96589eceee287108","reportUrl":"../1548//#testresult/96589eceee287108","status":"skipped","statusDetails":"XFAIL reason: aborted\n\n_pytest.outcomes.XFailed: aborted","time":{"start":1721439550955,"stop":1721439550955,"duration":0}},{"uid":"dab170985bb32803","reportUrl":"../1546//#testresult/dab170985bb32803","status":"passed","time":{"start":1721356344515,"stop":1721356534985,"duration":190470}},{"uid":"c603c037cafb668d","reportUrl":"../1543//#testresult/c603c037cafb668d","status":"passed","time":{"start":1721266670676,"stop":1721266899305,"duration":228629}},{"uid":"fe9baf71e31aa127","reportUrl":"../1541//#testresult/fe9baf71e31aa127","status":"passed","time":{"start":1721180358259,"stop":1721180543533,"duration":185274}},{"uid":"e5274f90916c0e7","reportUrl":"../1539//#testresult/e5274f90916c0e7","status":"passed","time":{"start":1721093965852,"stop":1721094167517,"duration":201665}}]},"tags":["asyncio","abort_on_fail","group(1)"]},"source":"9099b6017e1ac8d5.json","parameterValues":[]}